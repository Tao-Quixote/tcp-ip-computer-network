# TCP/IP 工具

## traceroute

traceroute 工具用于跟踪数据报的传输路径：当数据报从一台计算机传向另一台计算机时，会经过多重的网关，通过traceroute工具跟踪到的传输路径只是这两台计算机之间众多通路中的一条，所以不能肯定或假设数据报会永远只走这一条通路。如果你的计算机使用的是DNS，您还会经常从返回结果中辨认出城市、地区和运营商的名称。traceroute是一条缓慢的命令，因为每经过一台路由器都要花去大约10～15秒。

traceroute（Windows系统下是tracert）命令利用ICMP协议定位你的客户端计算机和目的计算机之间的所有路由器。TTL值可以反映数据包经过的路由器或网关的数量，通过操作原始的 ICMP Echo消息中使用的TTL值，traceroute命令能够找到数据包传输路径上的所有路由器，其过程如下：

1．将传递到目的 IP地址的 ICMP Echo消息的TTL值被设置为 1，该消息报经过第一个路由器时，其TTL值减去1，此时新产生的TTL值为0。

2．由于 TTL 值被置为 0，路由器判断此时不应该尝试继续转发数据报，而是直接抛弃该数据报。由于数据报的生存周期（TTL值）已经到期，这个路由器会发送过一个ICMP时间超时，即TTL值过期信息返回到客户端计算机。

3．此时，发出traceroute命令的客户端计算机将显示该路由器的名称，之后可以再发送一个 ICMP Echo消息并把TTL值设置为 2。

4．第1个路由器仍然对这个TTL值减1，然后，如果可能的话，将这个数据报转发到传输路径上的下一跳。当数据报抵达第2个路由器，TTL值会再被减去1，成为0值。

5．第2个路由器会像第1个路由器一样，抛弃掉这个数据包，并像第1个路由器那样返回一个ICMP消息。

6．该过程会一直持续，traceroute命令不停递增TTL值，而传输路径上的路由器不断递减该值，直到数据报最终抵达预期的目的地。

7．当目的计算机接收到 ICMP Echo消息时，会回传一个 ICMP Echo Reply消息。

除了能定位传输信息穿越过的路由器或网关之外，traceroute命令还能记录数据报抵达每个路由器的往返时间。根据实现情况，traceroute 命令实际上可能会给每个路由器发送多个单独的Echo消息。

## route

每台计算机和每台路由器都包含一张路由表。绝大多数路由器均使用专门的路由协议来交换路由信息，并动态地定期更新这些路由表。不过，还是有许多时候需要我们手动在路由器和主机路由表中添加记录。

route命令在TCP/IP网络中有许多用途：在数据包没有有效传递的情况下，可以利用route命令显示路由表；如果traceroute命令揭示出一条异常或低效率的传输路径，则可以使用route命令来确认为何选择该路径，而且可以配置一个更有效的路由。

route命令也可以被用来手动添加、删除和修改路由表中的条目，其选项如下所示：

* route print：route命令的这个形式会显示路由表中的当前条目。
* route add：使用 route命令的这个形式，可以向路由表添加一个新的路由条目。例如，要想指定一个去往5个路由器跳数之外的目的网络207.34.17.0的路由，而且首先会经过一台在本地网络上的IP地址为192.59.66.5和子网掩码为255.255.255.224的路由器，那么可以输入如下命令：
route add 207.34.17.0 mask 255.255.255.224 192.59.66.5 metric 5

注意：只是临时的路由

由这种方式添加的路由信息是暂时的，一旦计算机或路由器重新启动，这些信息就会消失。通常在启动脚本中会有一系列 route add命令，这样每次计算机或路由器启动时相应信息就会被再次应用。

*  route change：可以使用这个语法在路由表中修改条目。下面的示例是将数据的传输路径修改到另一台路由器，该路由器到目的距离有3跳：
route change 207.34.17.0 mask 255.255.255.224 192.59.66.7 metric 3
*  route delete 使用这个命令语法可以在路由表中删除一个条目：route delete 207.34.17.0。